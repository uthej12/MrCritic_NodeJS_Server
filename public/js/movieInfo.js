import{tmdb,njs,img,backdrop,v3,v3key}from"../js/serverDetails.js";var qs=new URL(document.location).searchParams,id=qs.get("id"),name=null,commented=!1;function convert_date(e){var a=Number(e.substring(0,4)),o=Number(e.substring(5,7)),t=Number(e.substring(8,11)),n=new Date(a,o-1,t).toString().split(" ");return n[0]+" "+n[2]+" "+n[1]+" , "+n[3]}console.log(id);const formatter=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2});$(document).ready(()=>{($(".add-comments").hide(),null!=id)&&(console.log(v3+id+"?api_key="+v3key),$.getJSON(v3+id+"?api_key="+v3key).done(e=>{console.log(e),$.ajax({type:"GET",url:njs+"favorites/movies/",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("token"))}}).done(a=>{$.each(a,(a,o)=>{o==e.id&&$("#add-to-wishlist").addClass("clicked")})}),$("#add-to-wishlist").click(()=>{$("#add-to-wishlist").hasClass("clicked")?($("#add-to-wishlist").removeClass("clicked"),$.ajax({type:"DELETE",url:njs+"favorites/movies/"+e.id,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("token"))}}).done(e=>console.log(e))):($("#add-to-wishlist").addClass("clicked"),$.ajax({type:"POST",url:njs+"favorites/movies/"+e.id,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("token"))}}).done(e=>console.log(e)))}),$(".jumbotron").css({"background-image":"url("+backdrop+e.backdrop_path+")"}),$(".poster").attr("src",img+e.poster_path),$(".movieName").append(e.title),$(".mov-year").append(" ("+e.release_date.split("-")[0]+")"),$(".star-rating h4").append(e.vote_average),$(".overview").append(e.overview),$(".release").append(convert_date(e.release_date));$(".ol").append({en:"English",hi:"Hindi",te:"Telugu",ta:"Tamil",ml:"Malayalam"}[e.original_language]),$.getJSON(v3+e.id+"?api_key="+v3key).done(e=>{$(".budget").append(formatter.format(e.budget)),e.revenue>0?$(".box").append(formatter.format(e.revenue)):$(".box").append(formatter.format(e.budget));for(var a=0;a<e.genres.length;a++)a>0&&$(".genre").append(", "),$(".genre").append(e.genres[a].name+" ")});$.getJSON(v3+e.id+"/recommendations?api_key="+v3key).done(e=>{$.each(e.results,(e,a)=>{e<8&&$(".rec").append("<div class ='rec-movie'><a href='movieInfo.html?id="+a.id+"'><img class='rec-img' src='"+img+a.backdrop_path+"'></a><div class='rec-text' style='overflow:hidden'><b>"+a.title.slice(0,22)+"</b></div></div>")})}),$.getJSON(njs+"comments/"+e.id).done(e=>{console.log(e);var a=!1;"unsucessful"!=e.status&&(console.log("Comments",e),$.each(e,(e,o)=>{o.author==name?(a=!0,$(".comments").append("<div class='col-12 col-lg-10 card comment-container'><div class='container-fluid' style='padding: 0'><div class='col-12'><span><img src='./images/user.png' alt='user' class='avatar'></span><h5><u>"+o.author+"</u></h5></div><div class='col-12 comment'><p>"+o.comment+"</p></div></div></div>")):$(".comments").append("<div class='col-12 col-lg-10 card comment-container'><div class='container-fluid' style='padding: 0'><div class='col-12'><span><img src='./images/user.png' alt='user' class='avatar'></span><h5>"+o.author+"</h5></div><div class='col-12 comment'><p>"+o.comment+"</p></div></div></div>")})),a||null==name?$(".add-comments").hide():$(".add-comments").show()});$("#submit-comment").click(()=>{console.log($("#comment").val()),$.ajax({type:"POST",url:njs+"comments/"+e.id,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("token"))},dataType:"json",data:{comment:$("#comment").val()}}).done(e=>{console.log(e),location.reload()})}),$.ajax({url:v3+e.id+"/credits?api_key="+v3key,type:"GET"}).done(e=>{$.each(e.cast,(e,a)=>{e<6&&$(".cast").append("<div class='col-6 col-sm-4 col-xl-2' style='padding:20px 60px 20px 0px;'><div class='card' style='box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);border-radius: 0%;height:350px;width:150px;'><div class='card-img-top' style='min-width: 100%;max-height: 100%'><img class='img-fluid' src='"+img+a.profile_path+"'></div><div class='card-content' style='padding:4px'><div class='card-title'><h4>"+a.name+"</h4></div><p style='color:dimgrey;bottom:0;position:absolute'>"+a.character.split("/")[0]+"</p></div></div></div>")});var a=0,o=0,t=0,n=0;$.each(e.crew,(e,s)=>{"Director"===s.job&&(a>0&&$(".director").append(", "),$(".director").append(s.name),a=Number(a)+1),"Producer"===s.job&&(0!==o&&$(".producer").append(", "),$(".producer").append(s.name," "),o=Number(o)+1),"Screenplay"===s.job&&(0!==t&&$(".writer").append(", "),$(".writer").append(s.name," "),t=Number(t)+1),"Original Music Composer"===s.job&&(0!==n&&$(".music").append(", "),$(".music").append(s.name," "),n=Number(n)+1)})})}))}),null==localStorage.getItem("token")?($(".authenticated").hide(),$("#loginButton").on("click",()=>{var e=$('[name="uname"]').val(),a=$('[name="password"]').val();console.log(JSON.stringify({username:e,password:a})),""!=e&&""!=a?$.ajax({type:"POST",dataType:"json",contentType:"application/json;charset=utf-8",url:njs+"users/login",data:JSON.stringify({username:e,password:a}),success:e=>{console.log(e),1==e.success&&($("#loginModal").modal("toggle"),$(".auth").hide(),$(".authenticated").show(),localStorage.setItem("token",e.token),location.reload())},error:e=>{alert("Invalid Credentials"),console.log(e)}}):alert("Enter valid data")}),$("#signup").on("click",()=>{var e=$('[name="name"]').val(),a=$('[name="email"]').val(),o=$('[name="runame"]').val(),t=$('[name="rpassword"]').val();$('[name="password2"]').val();console.log(JSON.stringify({name:e,email:a,username:o,password:t})),""!=o&&""!=t?$.ajax({type:"POST",dataType:"json",contentType:"application/json;charset=utf-8",url:njs+"users/signup",data:JSON.stringify({name:e,email:a,username:o,password:t}),success:e=>{console.log(e),1==e.success&&($("#registerModal").modal("toggle"),$("#loginModal").modal("toggle"))},error:e=>{alert("Invalid Credentials"),console.log(e)}}):alert("Enter valid data")})):($.ajax({type:"GET",url:njs+"users",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("token"))},dataType:"json",success:e=>{$(".logo .name").append(e.name),name=e.name,console.log(e)},error:e=>{console.log(e)}}),$(".authenticated").show(),$(".auth").hide(),$("#logout").click(()=>{confirm("Do want to logout?")&&(console.log(localStorage.getItem("token")),localStorage.clear(),$(".auth").show(),$(".authenticated").hide(),location.reload())})),$(".dropdown-menu a.dropdown-toggle").on("click",function(e){return $(this).next().hasClass("show")||$(this).parents(".dropdown-menu").first().find(".show").removeClass("show"),$(this).next(".dropdown-menu").toggleClass("show"),$(this).parents("li.nav-item.dropdown.show").on("hidden.bs.dropdown",function(e){$(".dropdown-submenu .show").removeClass("show")}),!1});